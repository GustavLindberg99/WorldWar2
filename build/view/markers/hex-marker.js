import{Hex}from"../../model/mapsheet.js";import InfoBubble from"../info/info-bubble.js";import PanZoom from"../pan-zoom.js";var HexMarker;!function(t){const e=["M2 3 v-2 h-0.5 v-1 h0.6 v0.5 h0.6 v-0.5 h0.6 v0.5 h0.6 v-0.5 h0.6 v1 h-0.5 v2","M2 3 v-2 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 v2","M2 3 v-1 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 l0.25 -0.25 l0.25 0.25 v1"],r=["M1.2 1 H4.8M1.7 0.3 L3.5 3M4.3 0.3 L2.5 3","M1.2 1 H4.8M1.7 0.3 L3.5 3","M1.2 1 H4.8"];t.onhexclick=null,t.drawAllCities=function(){for(let t of Hex.allCityHexes){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("class","cityMarker"),e.setAttribute("data-hex",`${t.x},${t.y}`);const r=document.createElementNS("http://www.w3.org/2000/svg","circle");if(r.setAttribute("cx",(t.centerX()+t.cityOffsetX*Hex.hexHeight/4).toString()),r.setAttribute("cy",(t.centerY()+t.cityOffsetY*Hex.hexHeight/4).toString()),r.setAttribute("r",(Hex.hexHeight/6).toString()),e.appendChild(r),t.isMajorPort()){const r=Hex.hexWidth/2,n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("transform",`translate(${t.centerX()+t.cityOffsetX*Hex.hexHeight/4}, ${t.centerY()+t.cityOffsetY*Hex.hexHeight/4}) scale(${r})`),n.setAttribute("d","M0,-0.2 V0.35 M-0.2,-0.05 h0.4 M-0.3,0.15 a0.6,1.5,0,0,0,0.6,0 M0,-0.2 a0.09,0.09,0,0,0,0,-0.18 a0.09,0.09,0,0,0,0,0.18"),n.setAttribute("fill","none"),n.setAttribute("stroke","#33bbff"),n.setAttribute("stroke-width","0.1"),e.appendChild(n)}const n=document.createElementNS("http://www.w3.org/2000/svg","text");let i=0,o=0;switch(t.cityAlignment){case"l":n.setAttribute("text-anchor","end"),i=-1;break;case"r":n.setAttribute("text-anchor","start"),i=1;break;case"t":n.setAttribute("text-anchor","middle"),o=-2;break;case"b":n.setAttribute("text-anchor","middle"),o=2}n.setAttribute("x",(t.centerX()+(t.cityOffsetX+i)*Hex.hexHeight/4).toString()),n.setAttribute("y",(t.centerY()+(t.cityOffsetY+o+.6)*Hex.hexHeight/4).toString()),n.setAttribute("font-size",.6*Hex.hexHeight+"px"),n.setAttribute("font-weight","bold"),e.appendChild(n);const s=t.country;t.isEnclaveCity&&s.name()===t.city||(n.textContent=t.city),t.isEnclaveCity&&(s.name()!==t.city&&n.appendChild(document.createTextNode(" (")),n.appendChild(InfoBubble.clickableCountryInfoLink(s,"http://www.w3.org/2000/svg")),s.name()!==t.city&&n.appendChild(document.createTextNode(")"))),document.getElementById("installations").appendChild(e)}},t.drawResourceHexes=function(){for(let t of Hex.allResourceHexes){const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("class","resourceMarker"),e.setAttribute("data-hex",`${t.x},${t.y}`),e.setAttribute("transform",`translate(${t.centerX()},${t.centerY()})`);const r=2*Hex.hexWidth/3;e.setAttribute("d","M"+-r/2+" "+r/Math.sqrt(12)+"H"+r/2+"L0 "+-r/Math.sqrt(3)+"Z"),e.setAttribute("fill","none"),e.setAttribute("stroke","black"),e.setAttribute("stroke-width","0.3"),document.getElementById("installations").appendChild(e)}},t.updateMarkers=function(t){const n=document.querySelector(`.resourceMarker[data-hex="${t.x},${t.y}"]`);null!==n&&(t.destroyedByAtomicBomb?n.remove():(t.resourceHexDestroyed?n.style.strokeDasharray="0.75":n.style.strokeDasharray="",t.installationsDestroyed?n.style.opacity="0.5":n.style.opacity="1"));const i=document.querySelector(`.cityMarker[data-hex="${t.x},${t.y}"]`);null!==i&&(t.destroyedByAtomicBomb?i.remove():t.installationsDestroyed?i.style.opacity="0.5":i.style.opacity="1");let o=document.querySelector(`.fortificationMarker[data-hex="${t.x},${t.y}"]`);t.fortified()||t.fortUnderConstruction()?(null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("class","fortificationMarker"),o.setAttribute("data-hex",`${t.x},${t.y}`),o.setAttribute("transform",`translate(${t.centerX()-2*Hex.hexHeight/3},${t.centerY()-Hex.hexHeight/3})`),o.setAttribute("fill","none"),o.setAttribute("stroke","darkred"),o.setAttribute("stroke-width","0.3"),document.getElementById("installations").appendChild(o)),o.setAttribute("d",e[t.monthsUntilFortFinished()])):(o?.remove(),o=null);let s=document.querySelector(`.airfieldMarker[data-hex="${t.x},${t.y}"]`);t.hasAirfield()||t.airfieldUnderConstruction()?(null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("class","airfieldMarker"),s.setAttribute("data-hex",`${t.x},${t.y}`),s.setAttribute("transform",`translate(${t.centerX()-Hex.hexHeight/2},${t.centerY()-Hex.hexHeight/4}) scale(${.19*Hex.hexWidth})`),s.setAttribute("fill","none"),s.setAttribute("stroke","darkblue"),s.setAttribute("stroke-width","0.3"),document.getElementById("installations").appendChild(s)),s.setAttribute("d",r[t.monthsUntilAirfieldFinished()])):(s?.remove(),s=null);let a=document.querySelector(`.atomicBombMarker[data-hex="${t.x},${t.y}"]`);t.destroyedByAtomicBomb?null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","image"),a.setAttribute("href","images/atomicbomb.svg"),a.setAttribute("transform","translate("+(t.centerX()-2*Hex.hexHeight/3)+","+(t.centerY()-Hex.hexHeight/3)+") scale("+.19*Hex.hexWidth+")"),a.setAttribute("x",(Hex.hexHeight/2).toString()),a.setAttribute("y","0"),a.setAttribute("width",Hex.hexHeight.toString()),a.setAttribute("height",Hex.hexHeight.toString()),a.setAttribute("preserveAspectRatio","none"),document.getElementById("installations").appendChild(a)):(a?.remove(),a=null)},t.hexAtPoint=function(t,e){const r=document.getElementById("mapsheet").getBoundingClientRect();[t,e]=PanZoom.clientPixelToSvgPixel(t-r.x-PanZoom.instance().getPan().x,e-r.y-PanZoom.instance().getPan().y);const n=(t/=Hex.hexWidth)%1,i=(e/=Hex.hexHeight)%1;let o=Math.floor(t);n<1/3&&(o%2==0?(i<.5&&n/2+i/3<1/6||i>.5&&n/2-i/3<-1/6)&&o--:(i<.5&&n/2-i/3<0||i>.5&&n/2+i/3<1/3)&&o--);const s=Math.floor(o%2?e-.5:e);return Hex.fromCoordinates(o,s)??null};let n=new Map;function i(t){n.get(t)?.remove()}t.colorHex=function(t,e){i(t);const r=document.createElementNS("http://www.w3.org/2000/svg","polygon"),o=[[t.centerX()-Hex.hexWidth/3,t.centerY()-Hex.hexHeight/2],[t.centerX()-2*Hex.hexWidth/3,t.centerY()],[t.centerX()-Hex.hexWidth/3,t.centerY()+Hex.hexHeight/2],[t.centerX()+Hex.hexWidth/3,t.centerY()+Hex.hexHeight/2],[t.centerX()+2*Hex.hexWidth/3,t.centerY()],[t.centerX()+Hex.hexWidth/3,t.centerY()-Hex.hexHeight/2]];r.setAttribute("points",o.map((t=>t.join(","))).join(" ")),r.setAttribute("fill",e),r.setAttribute("opacity","0.5"),r.setAttribute("stroke","none"),document.getElementById("selectedHexes").appendChild(r),n.set(t,r)},t.uncolorHex=i,t.scrollToHex=function(t){const[e,r]=PanZoom.svgPixelToClientPixel(t.centerX(),t.centerY()),n=document.getElementById("mapsheet").getBoundingClientRect();PanZoom.instance().pan({x:-e+n.width/2,y:-r+n.height/2})}}(HexMarker||(HexMarker={}));export default HexMarker;