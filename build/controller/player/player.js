import{refreshUI}from"../../utils.js";import{Hex}from"../../model/mapsheet.js";import{Partnership}from"../../model/partnership.js";import{Countries}from"../../model/countries.js";import{AirUnit,SupplyUnit,Unit}from"../../model/units.js";import HexMarker from"../../view/markers/hex-marker.js";import LeftPanel from"../../view/left-panel.js";import UnitMarker from"../../view/markers/unit-marker.js";export default class Player{partnership;static#e=[];constructor(e){this.partnership=e,Player.#e.push(this)}opponent(){return Player.#e.find((e=>e!==this))}static fromPartnership(e){return Player.#e.find((t=>t.partnership===e))}won(){return!!Countries.all().every((e=>e.partnership()===Partnership.Neutral||e.partnership()===this.partnership||e.conquered()))&&(this.partnership===Partnership.Allies||Countries.unitedStates.conquered()&&(Countries.sovietUnion.partnership()===this.partnership||Countries.sovietUnion.conquered()))}async incomePhase(){for(let e of this.partnership.countries())e.money+=e.income(),e.gotMoneyFromConvoys=!1}static async supplyPhase(){const e="Checking all units for supply, please wait...";LeftPanel.clear(),LeftPanel.appendParagraph(e),LeftPanel.addNextButtonLock(e);const t=[...Unit.allAliveUnits()].sort(((e,t)=>!(e instanceof SupplyUnit)&&t instanceof SupplyUnit?-1:e instanceof SupplyUnit&&!(t instanceof SupplyUnit)?1:0)).filter((e=>null===e.embarkedOn()));let n=0;LeftPanel.appendProgressBar((()=>n/t.length));for(let e of Hex.allHexes){const t=e.fortUnderConstruction()||e.airfieldUnderConstruction();e.continueBuilding(),t&&HexMarker.updateMarkers(e),await refreshUI(1e3)}for(let e of t)n++,await refreshUI(1e3),e.updateSupply()&&UnitMarker.get(e).update(),e instanceof AirUnit&&(e.usedMovementPoints=0);if(LeftPanel.releaseNextButtonLock(e),LeftPanel.clear(),LeftPanel.appendParagraph("All units have been checked to see if they're out of supply, and losses due to units being out of supply for too long have been inflicted."),Hex.chooseGroundedAirUnits(),0===Hex.groundedAirUnits.size)LeftPanel.appendParagraph("No air units are grounded this turn.");else{LeftPanel.appendParagraph("Air units are grounded in the following weather zones:");const e=document.createElement("ul");for(let t of Hex.groundedAirUnits){const n=document.createElement("li");n.textContent=t.toString(),e.appendChild(n)}LeftPanel.appendElement(e)}await LeftPanel.waitForNextButtonPressed("To war declaration")}}