import{addToMapOfSets}from"../../../utils.js";import CountryWithUnits from"../country-with-units.js";import{Hex}from"../../mapsheet.js";import{Partnership}from"../../partnership.js";import{Countries}from"../../countries.js";import{AirUnit,Armor,Battleship,Carrier,Destroyer,HeavyCruiser,Infantry,LightCruiser,Submarine,SupplyUnit,TransportShip}from"../../units.js";import{date,Month,month}from"../../date.js";export default class France extends CountryWithUnits{#e=!1;constructor(){super(Partnership.Allies),this.availableUnits=new Set([...new Array(80).fill(null).map((()=>new Infantry(1,3,this))),...new Array(8).fill(null).map((()=>new Armor(1,5,this))),...new Array(4).fill(null).map((()=>new SupplyUnit(3,this))),...new Array(2).fill(null).map((()=>new AirUnit("MS-406",this))),...new Array(2).fill(null).map((()=>new AirUnit("LeO-451",this))),new Destroyer("Jaguar",1,1,50,this),new Destroyer("Bison",1,1,51,this),new Destroyer("Aigle",1,1,51,this),new Destroyer("Vauquelin",1,1,51,this),new Destroyer("Le Fantasque",1,1,53,this),new Destroyer("Mogador",1,1,56,this),...new Array(2).fill(null).map((()=>new Destroyer("La Melpomène",1,1,49,this))),new LightCruiser("Pluton",1,1,43,this),new LightCruiser("Lamotte-Piquet",1,1,47,this),new LightCruiser("Primauguet",1,1,47,this),new LightCruiser("Jeanne d'Arc",1,1,36,this),new LightCruiser("Marseillaise",1,1,44,this),new LightCruiser("Jean de Vienne",1,1,44,this),new LightCruiser("Duguay-Trouin",1,1,47,this),new LightCruiser("La Galissonnière",1,1,44,this),new LightCruiser("Émile Bertin",1,1,49,this),new LightCruiser("Montcalm",1,1,44,this),new LightCruiser("George Leygues",1,1,44,this),new LightCruiser("Gloire",1,1,44,this),new HeavyCruiser("Colbert",3,2,46,this),new HeavyCruiser("Dupleix",3,2,46,this),new HeavyCruiser("Suffren",3,2,46,this),new HeavyCruiser("Foch",3,2,46,this),new HeavyCruiser("Algérie",3,3,44,this),new HeavyCruiser("Duquesne",3,3,49,this),new HeavyCruiser("Tourville",3,3,49,this),new Battleship("Courbet",4,4,30,this),new Battleship("Océan",4,4,30,this),new Battleship("Paris",4,4,30,this),new Battleship("Bretagne",4,5,29,this),new Battleship("Provence",4,5,29,this),new Battleship("Lorraine",4,5,29,this),new Battleship("Dunkerque",4,5,42,this),new Battleship("Strasbourg",4,5,42,this),new Battleship("Jean Bart",6,8,46,this),new Battleship("Richelieu",6,8,46,this),new Carrier("Béarn",3,31,this,new AirUnit("Latécoère 298",this)),new Submarine("Diane",3,2,20,this),new Submarine("Minerve",3,2,20,this),new Submarine("Requin",3,2,22,this),new Submarine("Saphir",3,2,17,this),...new Array(2).fill(null).map((()=>new Submarine("Redoutable",3,2,29,this))),...new Array(4).fill(null).map((()=>new TransportShip(this)))])}addNewAvailableUnits(){if(!this.conquered()){for(let e=0;e<2;e++)this.availableUnits.add(new Infantry(1,3,this));if(null!==this.enteredWar&&(month(date.current)%2==0||date.current>=this.enteredWar+12))for(let e=0;e<2;e++)this.availableUnits.add(new Armor(1,5,this));if(date.current===this.enteredWar){for(let e=0;e<16;e++)this.availableUnits.add(new SupplyUnit(3,this));for(let e=0;e<6;e++)this.availableUnits.add(new AirUnit("C-440 Goéland",this));for(let e=0;e<10;e++)this.availableUnits.add(new TransportShip(this));for(let e=0;e<25;e++)this.availableUnits.add(new Infantry(1,3,this))}date.current===date(1940,Month.January)&&(this.availableUnits.add(new AirUnit("C-714",this)),this.availableUnits.add(new AirUnit("LeO-451",this))),date.current===date(1940,Month.April)&&this.availableUnits.add(new AirUnit("LeO-451",this)),date.current===date(1940,Month.June)?(this.availableUnits.add(new Carrier("Joffre",3,48,this,new AirUnit("Latécoère 298",this))),this.availableUnits.add(new AirUnit("C-714",this))):date.current===date(1942,Month.June)&&this.availableUnits.add(new Carrier("Painlevé",3,48,this,new AirUnit("Latécoère 298",this)))}}liberate(){this.partnership()===Partnership.Neutral&&this.joinPartnership(Partnership.Allies),super.liberate()}shouldBeConquered(){return super.shouldBeConquered()||this.#e&&this.partnership()===Partnership.Neutral}shouldBeLiberated(){return this.partnership()===Partnership.Neutral?this.cities.every((e=>e.controller()===this||e.isColony||e.controller().partnership()===Partnership.Allies)):super.shouldBeLiberated()}additionalInvadedCountries(e){return[Countries.unitedKingdom].filter((t=>t.canBeInvadedBy(e)))}canSendMoneyWithoutConvoys(){return[Countries.germany,Countries.unitedKingdom].filter((e=>e.partnership()===this.partnership()&&!e.conquered()))}name(){return this.#e&&this.partnership()!==Partnership.Allies?"Vichy France":"France"}maxLandUnitStrength(){return 6}railCapacity(){return 3}color(){return"#f2f200"}canAttemptVichy(e){return e===Partnership.Axis&&!this.#e&&!this.hasBeenConquered()&&null!==this.enteredWar&&date.current<=this.enteredWar+24&&this.cities.some((e=>"Paris"===e.city&&e.controller().partnership()===Partnership.Axis))}attemptVichy(){return this.#e=!0,!(Math.random()<.25)&&(this.createVichy(),!0)}createVichy(){this.#e=!0,this.makeNeutral();for(let e of Hex.allHexes)if(e.country===this)if(e.secondaryController===this){e.setController(this);for(let t of e.units())t.delete(),addToMapOfSets(t.owner.delayedUnits,date.current,t)}else e.setController(e.landUnits().find((e=>e.owner!==this))?.owner??e.secondaryController);else e.controller()===this&&e.setController(Countries.unitedKingdom);this.conquerOrLiberate()}toJson(){let e=super.toJson();return e.hasAttemptedVichy=this.#e||void 0,e}loadFromJson(e){super.loadFromJson(e),this.#e=e.hasAttemptedVichy??!1}}