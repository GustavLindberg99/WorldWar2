import CountryWithUnits from"../country-with-units.js";import{Countries}from"../../countries.js";import{currentYear,date,Month,year}from"../../date.js";import{Partnership}from"../../partnership.js";import{AirUnit,Infantry,LightCruiser,NavalUnit}from"../../units.js";export default class China extends CountryWithUnits{constructor(){super(Partnership.Allies),this.availableUnits=new Set([...new Array(105).fill(null).map((()=>new Infantry(1,3,this))),new AirUnit("I-16",this),new AirUnit("HE-111",this),new LightCruiser("Ning Hai",1,1,33,this),new LightCruiser("Ying Swei",1,1,29,this),new LightCruiser("Chao Ho",1,1,29,this)])}joinPartnership(e){if(super.joinPartnership(e),currentYear()>=1938){const e=this.delayedUnits.get(date.current)??new Set;for(let t of e.values().filter((e=>e instanceof NavalUnit)))e.delete(t)}}addNewAvailableUnits(){if(!this.conquered()){if(date.current===this.enteredWar)for(let e=0;e<10;e++)this.availableUnits.add(new Infantry(1,3,this));if(date.current<=date(1938,Month.December)||1943===year(date.current))for(let e=0;e<2;e++)this.availableUnits.add(new Infantry(1,3,this));(null!==Countries.unitedStates.enteredWar&&date.current===Countries.unitedStates.enteredWar+12||null!==Countries.unitedStates.enteredWar&&date.current===Countries.unitedStates.enteredWar+24)&&this.availableUnits.add(new AirUnit("B-25 Mitchell",this))}}shouldBeLiberated(){return!this.shouldBeConquered()}income(){return this.conquered()?0:super.income()+600}name(){return"China"}maxLandUnitStrength(){return 3}railCapacity(){return 1}color(){return"#f2f27e"}canReceiveMoney(){return this.hexes.some((e=>e.controller().partnership()===Partnership.Allies&&!e.isTallMountain()&&e.adjacentLandHexes().some((e=>e.country===Countries.unitedKingdom&&e.controller().partnership()===Partnership.Allies&&!e.isTallMountain()))))}updateController(){for(let e of this.hexes){void 0===e.landUnits().find((e=>e.owner.partnership()!==this.partnership()))&&e.setController(this)}}}