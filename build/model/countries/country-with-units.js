import Country from"./country.js";import{date}from"../date.js";import{Infantry,Unit}from"../units.js";import{Partnership}from"../partnership.js";import{Countries}from"../countries.js";export default class CountryWithUnits extends Country{#e=new Set;units(){return Unit.allAliveUnits().filter((e=>e.owner===this))}joinPartnership(e){this.partnership()===Partnership.Neutral&&e===Partnership.Axis&&(this.#e=new Set),super.joinPartnership(e)}conquer(){for(let e of[...this.units(),...this.availableUnits,...this.delayedUnits.values().reduce(((e,t)=>[...e,...t]),new Array)]){if(e instanceof Infantry)for(let t=0;t<e.strength;t++){const t=Countries.china;(this.#e.size<5||this===t)&&this.#e.add(new Infantry(1,e.movementAllowance,this))}e.delete()}this.availableUnits=new Set,this.delayedUnits=new Map,super.conquer()}liberate(){if(super.liberate(),null!==this.#e){const e=this.#e.values();this.delayedUnits.set(date.current,new Set(e.take(5))),this.availableUnits=new Set(e),this.#e=new Set}}maxLandUnitStrength(){return 5}maxArmorStrength(){return 8}toJson(){let e=super.toJson();return this.#e.size>0&&(e.liberatedForces=[...this.#e.values().map((e=>e.toJson()))]),e}loadFromJson(e){super.loadFromJson(e),this.#e=new Set(e.liberatedForces?.map((e=>Unit.fromJson(e))))}}