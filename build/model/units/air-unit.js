import Unit from"./unit.js";import{SupplyLines}from"../mapsheet.js";import{Partnership}from"../partnership.js";import{Countries}from"../countries.js";import{Carrier,NavalUnit}from"../units.js";class AirUnit extends Unit{fighterStrength;bomberStrength;kamikazeBaseStrength;defense;model;imageUrl;usedMovementPoints=0;based=!1;#e=!1;#a=!1;constructor(e,a){let s,i,r,t,n,o=0;switch(e){case"ME-110C":case"ME-110D":s=1,i=3,r=2,t="ME-110D"===e?16:12,n="images/airplanes/me110.svg";break;case"ME-109":s=3,i=0,r=4,t=8,n="images/airplanes/me109.svg";break;case"HE-111":s=0,i=4,r=1,t=24,n="images/airplanes/he111.svg";break;case"HE-177":s=0,i=5,r=1,t=24,n="images/airplanes/he177.svg";break;case"FW-190":s=4,i=0,r=5,t=8,n="images/airplanes/fw190.svg";break;case"ME-262":s=6,i=0,r=7,t=4,n="images/airplanes/me262.svg";break;case"FI-167":s=1,i=3,r=2,t=8,n="images/airplanes/fi167.svg";break;case"JU-52":s=0,i=0,r=1,t=24,n="images/airplanes/ju52.svg";break;case"Hurricane":s=2,i=0,r=3,t=10,n="images/airplanes/hurricane.svg";break;case"Typhoon":s=3,i=3,r=4,t=8,n="images/airplanes/typhoon.svg";break;case"Spitfire":s=3,i=0,r=4,t=6,n="images/airplanes/spitfire.svg";break;case"Anson":s=0,i=3,r=1,t=24,n="images/airplanes/anson.svg";break;case"Blenheim":s=0,i=4,r=1,t=24,n="images/airplanes/blenheim.svg";break;case"Mosquito":s=1,i=5,r=1,t=32,n="images/airplanes/mosquito.svg";break;case"Lancaster":s=0,i=7,r=2,t=24,n="images/airplanes/lancaster.svg";break;case"Swordfish":s=1,i=3,r=2,t=8,n="images/airplanes/swordfish.svg";break;case"Fulmar":s=2,i=3,r=3,t=8,n="images/airplanes/fulmar.svg";break;case"Firefly":s=3,i=3,r=3,t=8,n="images/airplanes/firefly.svg";break;case"Dragon Rapide":s=0,i=0,r=1,t=24,n="images/airplanes/dragonrapide.svg";break;case"B-17 Flying Fortress":s=0,i=8,r=1,t=32,n="images/airplanes/b17.svg";break;case"B-24 Liberator":s=0,i=10,r=2,t=32,n="images/airplanes/b24.svg";break;case"B-25 Mitchell":s=0,i=5,r=1,t=14,n="images/airplanes/b25.svg";break;case"B-26 Marauder":s=0,i=6,r=1,t=18,n="images/airplanes/b26.svg";break;case"B-29 Superfortress":s=0,i=12,r=4,t=32,n="images/airplanes/b29.svg";break;case"P-36 Hawk":s=2,i=0,r=3,t=6,n="images/airplanes/p36.svg";break;case"P-38 Lightning":s=2,i=3,r=3,t=16,n="images/airplanes/p38.svg";break;case"P-40 Warhawk":s=3,i=3,r=4,t=10,n="images/airplanes/p40-warhawk.svg";break;case"P-40 Kittyhawk":s=2,i=3,r=2,t=6,n="images/airplanes/p40-kittyhawk.svg";break;case"P-47 Thunderbolt":s=3,i=0,r=4,t=8,n="images/airplanes/p47.svg";break;case"P-51 Mustang":s=4,i=0,r=5,t=12,n="images/airplanes/p51.svg";break;case"F4F Wildcat":s=2,i=3,r=4,t=8,n="images/airplanes/f4f.svg";break;case"F6F Hellcat":s=4,i=3,r=5,t=8,n="images/airplanes/f6f.svg";break;case"DC-3":s=0,i=0,r=1,t=24,n="images/airplanes/dc3.svg";break;case"MS-406":s=2,i=0,r=3,t=8,n="images/airplanes/ms406.svg";break;case"C-714":s=3,i=0,r=4,t=6,n="images/airplanes/c714.svg";break;case"LeO-451":s=0,i=3,r=1,t=20,n="images/airplanes/leo451.svg";break;case"Latécoère 298":s=1,i=3,r=2,t=8,n="images/airplanes/latecoere298.svg";break;case"C-440 Goéland":s=0,i=0,r=1,t=24,n="images/airplanes/c440.svg";break;case"CR-32":s=1,i=0,r=2,t=8,n="images/airplanes/cr32.svg";break;case"C-202":s=2,i=0,r=3,t=8,n="images/airplanes/c202.svg";break;case"C-205":s=3,i=0,r=4,t=8,n="images/airplanes/c205.svg";break;case"SM-79 Sparveiro":s=0,i=4,r=1,t=24,n="images/airplanes/sm79.svg";break;case"IAR-80":s=1,i=3,r=2,t=12,n="images/airplanes/iar80.svg";break;case"PZL P-11":s=1,i=0,r=1,t=12,n="images/airplanes/p11.svg";break;case"Gladiator":s=1,i=3,r=2,t=8,n="images/airplanes/gladiator.svg";break;case"IK-2":s=1,i=0,r=2,t=8,n="images/airplanes/ik2.svg";break;case"J-22":s=2,i=3,r=3,t=10,n="images/airplanes/j22.svg";break;case"S-16":s=1,i=3,r=2,t=6,n="images/airplanes/s16.svg";break;case"I-16":s=1,i=0,r=1,t=10,n="images/airplanes/i16.svg";break;case"LaGG-3":s=1,i=0,r=2,t=10,n="images/airplanes/lagg3.svg";break;case"Yak-9":s=2,i=0,r=3,t=10,n="images/airplanes/yak9.svg";break;case"Yer-2":s=0,i=4,r=1,t=20,n="images/airplanes/yer2.svg";break;case"Tu-2":s=0,i=5,r=1,t=20,n="images/airplanes/tu2.svg";break;case"Li-2":s=0,i=0,r=1,t=24,n="images/airplanes/li2.svg";break;case"Beaufort":s=0,i=5,r=1,t=14,n="images/airplanes/beaufort.svg";break;case"Boomerang":s=2,i=0,r=2,t=4,n="images/airplanes/boomerang.svg";break;case"D.XXI":s=1,i=0,r=1,t=6,n="images/airplanes/dxxi.svg";break;case"A5M":s=2,i=3,r=3,t=8,n="images/airplanes/a5m.svg";break;case"A6M":s=3,i=3,r=4,t=8,n="images/airplanes/a6m.svg";break;case"A7M":s=4,i=3,r=5,t=8,n="images/airplanes/a7m.svg";break;case"L2D":s=0,i=0,r=1,t=20,n="images/airplanes/l2d.svg";break;case"MXY-7 Ohka":s=0,i=0,o=5,r=6,t=2,n="images/airplanes/mxy7.svg";break;case"P1Y Ginga":s=0,i=5,r=1,t=28,n="images/airplanes/p1y.svg";break;case"Ki-21":s=0,i=5,r=1,t=16,n="images/airplanes/ki21.svg";break;case"Ki-27":s=1,i=0,r=2,t=6,n="images/airplanes/ki27.svg";break;case"Ki-43 Hayabusa":s=2,i=0,r=3,t=10,n="images/airplanes/ki43.svg";break;case"Ki-46":s=3,i=0,r=4,t=12,n="images/airplanes/ki67.svg";break;case"Ki-48-Ia":case"Ki-48-IIa":case"Ki-48-IIc":s=0,i=8,r="Ki-48-IIc"===e?2:1,t="Ki-48-IIa"===e?24:20,n="images/airplanes/ki48.svg";break;case"Ki-67 Hiryu":s=0,i=6,r=2,t=16,n="images/airplanes/ki67.svg";break;case"Ki-84 Hayate":s=4,i=0,r=5,t=8,n="images/airplanes/ki84.svg"}super(t,a),this.fighterStrength=s,this.bomberStrength=i,this.kamikazeBaseStrength=o,this.defense=r,this.model=e,this.imageUrl=n}setHex(e){super.setHex(e),this.based=!1}embarkOnto(e){super.embarkOnto(e),this.based=!0}delete(){super.delete(),this.#a=!1,this.usedMovementPoints=0}die(){for(let e of this.embarkedUnits())e.die();this.based&&this.owner.availableUnits.add(this),this.delete()}type(){let e=[];return this.isFighter()&&e.push("Fighter"),this.isBomber()&&e.push("Bomber"),this.isTransportUnit()&&e.push("Transport"),"MXY-7 Ohka"===this.model&&(e=["Kamikaze only"]),`Air unit (${(this.carrierBased()?"Carrier-based ":"")+e.join("-")})`}price(){return this.isFighter()?800:this.isBomber()?600:300}delay(){return this.isFighter()||this.isBomber()?4:2}outOfSupply(){return this.#e&&this.#s(),this.#e}updateSupply(){return this.#s(),this.embarkedUnits().values().some((e=>e.updateSupply()))}#s(){const e=this.hex();null===e?this.#e=!1:this.based?this.#e=this.embarkedOn()?.outOfSupply()??!SupplyLines.canTraceSupplyLine(e,this.owner):this.#e=!0}canAttack(e=null){let a=!1;return this.isFighter()&&(a||=null===e||e instanceof AirUnit),this.isBomber()&&(a||=null===e||!(e instanceof AirUnit)),this.canDoKamikaze()&&(a||=null===e||e instanceof NavalUnit),super.canAttack(e)&&a}canAttackInHex(e){return super.canAttackInHex(e)&&this.isAlive()&&!this.based&&this.hex()===e.hex()&&null===this.embarkedOn()&&null===e.embarkedOn()}modifiedLandAttack(){return this.bomberStrength/(this.damaged()?2:1)}canEnterHexWithinStackingLimits(e,a=!1,s=e.units()){const i=[...s];return!a||i.filter((a=>a!==this&&a instanceof AirUnit&&(a.based||i.includes(a)&&a.hex()!==e||!a.isAlive()))).length<e.airbaseCapacity()}validateMovement(e,a){return e.length+this.usedMovementPoints-1<=this.movementAllowance&&e.every(((a,s)=>0===s||a.adjacentHexes().includes(e[s-1])))&&this.validateMovementThroughNeutralCountries(e)&&e.every((e=>!e.airUnitsGrounded()))}canEmbarkOnto(e){return this.carrierBased()&&e instanceof Carrier&&!e.damaged()&&e.owner.partnership()===this.owner.partnership()}sameTypeAndStrength(e){return this.owner===e.owner&&e instanceof AirUnit&&this.model===e.model}sameBasicType(e){return e instanceof AirUnit&&e.owner.partnership()===this.owner.partnership()&&e.based===this.based}damaged(){return this.#a}damage(){this.canTakeDamage()?this.#a=!0:this.die()}canTakeDamage(){return!this.damaged()&&"ME-262"!==this.model&&"MXY-7 Ohka"!==this.model}repair(){this.#a=!1}carrierBased(){return/^(FI-167|Swordfish|Fulmar|Firefly|F4F Wildcat|F6F Hellcat|Latécoère 298|A[567]M|MXY-7 Ohka)$/.test(this.model)}isTransportUnit(){return/^(JU-52|Dragon Rapide|DC-3|Li-2|L2D|C-440 Goéland|SM-79 Sparveiro)$/.test(this.model)}isFighter(){return this.fighterStrength>0}isBomber(){return this.bomberStrength>0||this.kamikazeBaseStrength>0}canDoKamikaze(){return this.owner===Countries.japan&&(this.isBomber()||this.kamikazeBaseStrength>0)&&Countries.japan.cities.some((e=>e.controller().partnership()===Partnership.Allies))}canDoInstallationBombing(e){return 0===this.bomberStrength?"Only bombers can bomb.":e.controller()?.partnership()!==this.owner.partnership()?.opponent()?"You can only bomb hexes your opponent controls.":0!==e.airbaseCapacity()||e.fortified()?this.hasAttacked?"This unit has already attacked this turn.":null:"There's nothing to bomb in this hex."}canDoStrategicBombing(e){return 0===this.bomberStrength?"Only bombers can bomb.":e.controller()?.partnership()!==this.owner.partnership()?.opponent()?"You can only bomb hexes your opponent controls.":e.isResourceHex?e.resourceHexDestroyed||e.destroyedByAtomicBomb?"This resource hex is already destroyed.":this.hasAttacked?"This unit has already attacked this turn.":null:"You can only do strategic bombing in resource hexes."}canDoAtomicBombing(e){return["B-29 Superfortress","Ki-48-IIc","HE-177","Tu-2","Lancaster"].includes(this.model)?this.owner.hasAtomicBomb()?this.owner.hasUsedAtomicBombThisTurn?`${this.owner.name()} has already used the atomic bomb this turn.`:e.controller()?.partnership()!==this.owner.partnership()?.opponent()?"You can only bomb hexes your opponent controls.":e.destroyedByAtomicBomb?"This hex is already destroyed.":this.hasAttacked?"This unit has already attacked this turn.":null:`${this.owner.name()} doesn't have an atomic bomb yet.`:"This air unit model can't drop atomic bombs."}toJson(){let e=super.toJson();return e.outOfSupply=this.#e||void 0,e.damaged=this.#a||void 0,e.model=this.model,e.usedMovementPoints=this.usedMovementPoints||void 0,e.based=this.based,e}static validateAirUnitJson(e){const a=AirUnit.models;return"model"in e&&a.includes(e.model)?"based"in e&&"boolean"==typeof e.based?!("usedMovementPoints"in e)||"number"==typeof e.usedMovementPoints&&e.usedMovementPoints>=0||(console.warn("Invalid air unit: invalid usedMovementPoints."),!1):(console.warn("Invalid air unit: invalid based."),!1):(console.warn("Invalid air unit: invalid model."),!1)}static airUnitFromJson(e,a){const s=new AirUnit(e.model,a);return s.#e=e.outOfSupply??!1,s.#a=e.damaged??!1,s.usedMovementPoints=e.usedMovementPoints??0,s}}!function(e){e.models=["ME-110C","ME-110D","ME-109","HE-111","HE-177","FW-190","ME-262","FI-167","JU-52","Hurricane","Typhoon","Spitfire","Anson","Blenheim","Mosquito","Lancaster","Swordfish","Fulmar","Firefly","Dragon Rapide","B-17 Flying Fortress","B-24 Liberator","B-25 Mitchell","B-26 Marauder","B-29 Superfortress","P-36 Hawk","P-38 Lightning","P-40 Warhawk","P-40 Kittyhawk","P-47 Thunderbolt","P-51 Mustang","F4F Wildcat","F6F Hellcat","DC-3","MS-406","C-714","LeO-451","Latécoère 298","C-440 Goéland","CR-32","C-202","C-205","SM-79 Sparveiro","IAR-80","PZL P-11","Gladiator","IK-2","J-22","S-16","I-16","LaGG-3","Yak-9","Yer-2","Tu-2","Li-2","Beaufort","Boomerang","D.XXI","A5M","A6M","A7M","L2D","MXY-7 Ohka","P1Y Ginga","Ki-21","Ki-27","Ki-43 Hayabusa","Ki-46","Ki-48-Ia","Ki-48-IIa","Ki-48-IIc","Ki-67 Hiryu","Ki-84 Hayate"]}(AirUnit||(AirUnit={}));export default AirUnit;